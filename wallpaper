#!/usr/bin/env sh

fls="$( find "$( getloc wa )" -mindepth 1 -maxdepth 1 -type f )"

[ "$1" = "1" ] && {
    shuffle="1"
    fls="$( printf "%s" "$fls" | shuf )"
    shift
}

if [ "$2" ]
then
    [ "$1" ] && {
        sleep "$1"
        hsetroot -cover "$( printf "%s" "$fls" | head -n 1 )"
    }

    sleep "$2"
    hsetroot -cover "$( printf "%s" "$fls" | head -n 1 )"
elif [ "$4" ]
then
    sleeptime="$4"
elif [ "$1" ]
then
    sleeptime="$1"
else
    sleeptime="15m"
fi

[ "$3" ] && {
    sleep "$3"
}

while true
do
    printf "%s" "$fls" | while read -r i
    do
        hsetroot -cover "$i"
        sleep "$sleeptime"
    done

    [ "$shuffle" = "1" ] && fls="$( printf "%s" "$fls" | shuf )"
done
