#!/usr/bin/env sh

waloc="$(getloc wa)" || {
    printf "[ERROR]: getloc failed, aborting.\n"
    exit 1
}

find "$waloc" -mindepth 1 -maxdepth 1 \( -type f -o -type l \) -print0 | xargs -r0 file --mime-type | grep ":\s\+image/[a-z]\+$" | awk -F ':' '{print $1}' | shuf -r | while IFS= read -r i
do
    cmp -s -- "$i" "$last" 2> /dev/null && continue
    hsetroot -cover "$i" > /dev/null || continue
    last="$i"
    sleep "$@"
done
