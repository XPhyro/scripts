#!/usr/bin/env sh
# Log clipped text as a daemon (though it does not fork out). clplogynk be used to list and copy these with rofi.
# This script and clplogynk assume that the copied string does not contain the character .

fl="$( getfl clp )"
lckfl="$( getfl clplck )"
lastclp="$( xclip -o -sel clip )"

while true
do
    while clipnotify
    do
        [ -f "$lckfl" ] && {
            rm "$lckfl" && lastclp="$( xclip -o -sel clip )"
            continue
        }

        clp="$( xclip -o -sel clip )"
        [ "$( printf "%s" "$clp" | sed '/^\s*$/d' )" = "" ] && continue
        [ "$clp" = "$lastclp" ] || {
            printf ": %s;\n### BEGIN CLIP ###\n%s\n### END CLIP ###\n" "$( date +%s )" "$( printf "%s\n" "$clp" | tr '\n' '' )" >> "$fl"
            lastclp="$clp"
        }
    done
done
