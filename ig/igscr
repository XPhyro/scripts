#!/usr/bin/env sh

trap ctrl_c INT

ctrl_c() {
    [ "$newfollow" ] && [ -f "$newfollow" ] && rm "$newfollow"
    exit 0
}

scrape() {
    instagram-scraper "@$1" -f "$2" -T '{username}_{year}-{month}-{day}_{h}-{m}-{s}_{urlname}_{shortcode}' --profile-metadata --media-metadata --latest --retry-forever
}

cd "$( getloc igg )" || exit

newfollow="$( dupe follow )"
sed -r -e '/^#/d' -e '/^$/d' -e 's/\s+.*$//' -i "$newfollow"
if [ "$1" = "-r" ]
then
    sort -r -o "$newfollow" "$newfollow"
else
    sort -o "$newfollow" "$newfollow"
fi

cp "$newfollow" "$newfollow"_

sed -i '/[v-zV-Z].*/d' "$newfollow"
sed -i '/[a-uA-U].*/d' "$newfollow"_

scrape args "$newfollow"
scrape args_ "$newfollow"_

[ -f "$newfollow" ] && rm "$newfollow"
[ -f "$newfollow"_ ] && rm "$newfollow"_
