#!/usr/bin/env sh
# Find music scores in PDF format, prompt them with dmenu and open the selected one.

dir="$( getloc mu )"
cd "$dir" || {
    notify-send "view-music" "Could not cd to $dir."
    exit 0
}

fls="$( find . -mindepth 2 -iname "*.pdf" -printf "%A@;%p\n" | sort -nr | sed 's|^.*;\./||' )"

fl="$( printf "%s" "$fls" | dmenu -i -l 20 -p "Select sheet music:" )"

[ "$fl" = "" ] && exit 0

cmd="xdg-open"

for i
do
    if [ "$cmdget" ]
    then
        cmd="$i"
        unset cmdget
    elif [ "$i" = "-c" ] || [ "$i" = "--command" ]
    then
        cmdget="1"
    fi
done

if [ -z "$cmd" ] || [ -z "$fl" ] 
then
    exit 0
fi

notify-send -t 2000 "view-music" "Opening $( basename "$fl" ) with $cmd."
"$cmd" "$fl"
