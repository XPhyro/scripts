#!/usr/bin/env sh
# Find music scores in PDF format, prompt them with dmenu and open the selected one.
# TODO: Ask how many times the document should be opened and open that many. After all of the documents are closed, ask whether the amount was satisfactory, then save the amount such that it will not be asked the next time if it was satisfactory; else, ask for a new number and if given, save that instead.

dir="$( getloc mu )"
cd "$dir" || {
    notify-send "view-music" "Could not cd to $dir."
    exit 0
}

fls="$( find . -mindepth 2 -iname "*.pdf" -printf "%A@;%p\n" | sort -nr | sed 's|^.*;\./||' )"

fl="$( printf "%s" "$fls" | dmenu -i -l 20 -p "Select sheet music:" )"

[ "$fl" = "" ] && exit 0

cmd="xdg-open"

for i
do
    if [ -n "$cmdget" ]
    then
        cmd="$i"
        unset cmdget
    elif [ "$i" = "-c" ] || [ "$i" = "--command" ]
    then
        cmdget="1"
    fi
done

if [ -z "$cmd" ] || [ -z "$fl" ] 
then
    exit 0
fi

notify-send -t 2000 "view-music" "Opening $( basename "$fl" ) with $cmd."
"$cmd" "$fl"
